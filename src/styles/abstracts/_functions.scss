@use "sass:math";
@use "sass:meta";
@use "sass:map";
@use "sass:color";

@function get-rem($px, $base: 16px) {
    @if meta.type-of($px) !="number" {
        @error "get-rem() expects a number, got: #{meta.type-of($px)}";
    }

    @if math.is-unitless($px) {
        $px: $px * 1px;
    }

    @return math.div($px, $base) * 1rem;
}

@function strip-unit($value) {
    @if meta.type-of($value) !="number" {
        @error "strip-unit() expects a number, got: #{meta.type-of($value)}";
    }

    @if math.is-unitless($value) {
        @return $value;
    }

    @return math.div($value, ($value * 0 + 1));
}

@function rgb-channels($value) {
    @if meta.type-of($value) !="color" {
        @error "rgb-channels() expects a color, got: #{meta.type-of($value)}";
    }

    @return #{color.channel($value, "red", $space: rgb)} #{color.channel($value, "green", $space: rgb)} #{color.channel($value, "blue", $space: rgb)};
}

@function grid-size($size, $columns: 12) {
    @if $size ==null or meta.type-of($size) !="number" or $size <=0 or $size >$columns {
        @error "Invalid size: #{$size}. It must be a number between 1 and #{$columns}.";
    }

    @return math.percentage(math.div($size, $columns));
}

@function breakpoint-value($size, $breakpoints: null, $base: 16px) {
    @if meta.type-of($size)=="string" {
        @if $breakpoints ==null or meta.type-of($breakpoints) !="map" {
            @error "breakpoint-value(): pass `$breakpoints` when using string keys (e.g. md).";
        }

        @if map.has-key($breakpoints, $size) {
            @return map.get($breakpoints, $size);
        }

        @error "Unknown breakpoint `#{$size}`.";
    }

    @if meta.type-of($size)=="number" {
        @if math.unit($size)=="rem" {
            @return $size;
        }

        @return get-rem($size, $base);
    }

    @error "Unknown breakpoint `#{$size}`. Use a key or a number (e.g. 768px).";
}

@function breakpoint-max($breakpoint, $base: 16px) {
    @if meta.type-of($breakpoint) !="number" {
        @error "breakpoint-max() expects a number, got: #{meta.type-of($breakpoint)}";
    }

    // clamp
    @if $breakpoint <=0 {
        @return 0;
    }

    @if math.unit($breakpoint)=="rem" {
        @return $breakpoint - get-rem(1px, $base);
    }

    @if math.unit($breakpoint)=="px" {
        @return $breakpoint - 1px;
    }

    @return $breakpoint;
}